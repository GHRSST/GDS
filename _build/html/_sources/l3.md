---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
---
(l3)=
# Level 3 (L3) Product Specification

## Overview description of the GHRSST L3 data product

GHRSST L3 data have been introduced to provide users with gridded, synthetic,
and potentially adjusted SST products, bringing added value with respect to the
original L2P but still allowing traceability to the original dataset. GHRSST L3
products do not use analysis or interpolation procedure to fill gaps where no
observations are available. The GHRSST L3 products include:

- **Un-collated** data that represent a straightforward remapping of L2P GHRSST
  data granules to a space grid without combining any observations from
  overlapping orbits or times. Although in principle these data may or may not
  be adjusted to a reference sensor, in practice the un-collated L3 will
  normally be a remapped L2P dataset. For remapping best practices of L2P on 
  a  grid, see {numref}`l2_remapping_best_practice`.
- **Collated** data that grid observations from a single instrument and a single
  platform into space and/or time bins. These data may or may not be adjusted to
  a reference sensor. For collating best practices, see 
  {numref}`collating_best_practice` and for adjustment best practices see
  {numref}`adjustment_best_practice`.
- **Super-collated** data that combine observations from a multiple instruments
  into a space-time grid. In this case, the adjustment to a common reference is
  necessary to avoid heterogeneities in the resulting field. For best practices
  concerning the creation of super collated files see
  {numref}`supercollating_best_practice`

As a result, the format of a L3 file will be able to cope with the three kinds
of L3 SST presented above. The L3 format will include the following parts:

1. **In case the L3 is un-adjusted**, a mandatory section containing the 
   original L2P information remapped onto the grid point: the original sea 
   surface temperature, quality level and SSES information. An optional 
   section including the remapping condition information may also be 
   provided. These files are essentially gridded L2P files.
2. **In case the L3 is adjusted to a reference**, the adjusted SST value must 
   be provided, together with the local bias to the reference, the error 
   generated by the adjustment processing, and the overall error resulting 
   from the combination of the SSES and the adjustment processing error.
3. **In case the L3 is super-collated**, the source of SST at each pixel is 
   mandatory.

**Un-adjusted files**: In the case of **un-collated or collated un-adjusted L3
files** the L3 file is derived from L2P data by a remapping process. The
remapping and collating best practices are given in 
{numref}`l2_remapping_best_practice`. Their content is thus identical to that 
of the L2P, but complementary, optional information on the remapping conditions 
may be provided.

**Adjusted files**: Collated files may or may not be adjusted, but a 
super-collated file is necessarily adjusted. The super-collating and adjustment 
best practices are described in {numref}`collating_best_practice` and 
{numref}`adjustment_best_practice`. The principle governing this format is to 
allow traceability to the original L2P, while providing the best-adjusted SST 
value. A first section (in blue in {numref}`l3_content`) reproduces the original 
L2P SST and SSES information as in the un-adjusted version. The reference used 
to adjust the SST must be given in the “reference” attribute of the 
`adjusted_sea_surface_temperature` variable. The adjusted SST and some error 
information are also mandatory. This information, in yellow in 
{numref}`l3_content`, is: 
- `adjusted_standard_deviation_error`: the total error resulting from the 
   combination of the SSES error and the adjustment procedure error, 
   `standard_deviation_to_reference_sst`.
- `bias_to_reference_sst`: the local value of the estimated difference between
  the original SST and the reference SST
- `standard_deviation_to_reference_sst`: an estimate of the error resulting 
  from the adjustment procedure. If the procedure consists of analysing a field 
  of differences of original SST and reference SST, the 
  `standard_deviation_to_reference_sst` will be the error of this analysis.

The GHRSST Science Team determined that 5 mandatory fields will form the core
data content of a GHRSST L3 data file. In addition to global attributes and
geo-location information, GHRSST producers must provide the following within 
a L3 file:
- Sea Surface temperature data (SST),
- Time of SST measurement,
- Bias and Standard Deviation error estimates for SST data,
- Data quality.

There are a number of optional fields that may be used at the data provider’s
discretion that will form the core data content of a GHRSST data
file ({numref}`l3_data_records`).

The GHRSST L3 file contents are summarized in {numref}`l3_content` below.

<style>
.l3-content-css tbody tr:nth-child(n+1):nth-child(-n+2) { background:#42d1f5; }
.l3-content-css tbody tr:nth-child(3) { background:#f2f564; }
.l3-content-css tbody tr:nth-child(4) { background:#42d1f5; }
</style>

```{table} Summary description of the contents within a GHRSST L3 data product
:name: l3_content
:class: l3-content-css

| netCDF File Contents | Description                                                                                               |
|----------------------|-----------------------------------------------------------------------------------------------------------|
| **Coordinate variables**  | Information to permit locating data on grids, as defined in {numref}`coordinate_variables` | 
| **L2P Data record variables** | Core and auxiliary variables as defined in {numref}`l2p_records`                                          | 
| **L3 Data record variables** | Special Level 3 variables as defined in {numref}`l3_data_records`                                          | 
| **Global Attributes**     | A collection of required global attributes describing general characteristics of the file, as defined in section {numref}`global_attributes`  |
```

## L3 data record format specification

This table provides an overview of the GHRSST L3 product pixel data record that
should be created for each input data. Within GHRSST L3 data files, there are
many variables that are defined identically to their L2P counterparts. In
addition, there are several variables that are unique to L3. Both types are
listed below in {numref}`l3_data_records`. In the following sections, each 
variable within the L3 data file that is unique to L3 is described in detail.

<style>
.l3-variables-css tbody tr:nth-child(n+1):nth-child(-n+6) { background:#42d1f5; }
.l3-variables-css tbody tr:nth-child(n+7):nth-child(-n+8) { background:#dfadf7; }
.l3-variables-css tbody tr:nth-child(9) { background:#42d1f5; }
.l3-variables-css tbody tr:nth-child(n+10):nth-child(-n+14) { background:#dfadf7; }
.l3-variables-css tbody tr:nth-child(n+15):nth-child(-n+16) { background:#42d1f5; }
.l3-variables-css tbody tr:nth-child(n+17):nth-child(-n+22) { background:#f2f564; }
</style>

```{table} Summary description of GHRSST L2P data records
:name: l3_data_records
:class: l3-variables-css

| Variable Name          | Description            | Units  | Storage type |
|-----------------------|------------------------|--------|-----|
| [sea_surface_temperature](__l2p_sea_surface_temperature) | SST measurement values from input L2 satellite data set. | K (kelvin) | short |
| [sst_dtime](__l2p_sst_dtime) | The deviation in time of SST measurement from reference time | s (second)| short |
| [sses_bias](__l2p_sses_bias) | Sensor Specific Error Statistic (SSES) bias error | K (kelvin)| byte |
| [sses_standard_deviation](__l2p_sses_standard_deviation) | Sensor Specific Error Statistic (SSES) standard deviation uncertainty | K (kelvin)| byte |
| [dt_analysis](__l2p_dt_analysis) | The difference between input SST and a GHRSST L4 SST analysis from the previous 24 hour period | K (kelvin)| byte or short|
| [wind_speed](__l2p_wind_speed) | Closest (in time) 10 m surface wind speed from satellite or analysis  | m s-1 | byte |
| [wind_speed_dtime_from_sst](__l2p_wind_speed_dtime_from_sst) | Time difference of `wind_speed` data from input L2 SST measurement specified in hours.| h (hours) | byte |
| [source_of_wind_speed](__l2p_source_of_wind_speed) | Source(s) of `wind_speed` data. Mandatory when multiple sources used. | Code| byte |
| [sea_ice_fraction](__l2p_sea_ice_fraction) | Closest (in time) sea ice fraction from satellite or analysis | 1 | byte |
| [sea_ice_fraction_dtime_from_sst](__l2p_sea_ice_fraction_dtime_from_sst) | Time difference of `sea_ice_fraction` data from input L2 SST measurement specified in hours| h (hours)| byte |
| [source_of_sea_ice_fraction](__l2p_source_of_sea_ice_fraction) | Source(s) of `sea_ice_fraction` data | code | byte |
| [aerosol_dynamic_indicator](__l2p_aerosol_dynamic_indicator) | Atmospheric aerosol indicator | | byte |
| [adi_dtime_from_sst](__l2p_adi_dtime_from_sst) | Time difference between the `aerosol_dynamic_indicator` value and SST measurement | h (hour) | byte |
| [source_of_adi](__l2p_source_of_adi) | Source(s) of atmospheric aerosol indicator data  | code | byte |
| [l2p_flags](__l2p_l2p_flags) | Data flag values | mask of bits | short |
| [quality_level](__l2p_quality_level) | Overall indication of L2P data quality | enum | byte |
| [satellite_zenith_angle](__l2p_satellite_zenith_angle) | Calculated satellite zenith angle (measured at the Earth's surface between the satellite and the zenith)| degree | byte |
| [solar_zenith_angle](__l2p_solar_zenith_angle) | Calculated solar zenith angle (the angle between the local zenith and the line of sight to the sun, measured at the Earth's surface)| degree | byte |
| [surface_solar_irradiance](__l2p_surface_solar_irradiance) | Near contemporaneous surface solar irradiance| W m-2| byte |
| [ssi_dtime_from_sst](__l2p_ssi_dtime_from_sst) | Time difference between the `surface_solar_irradiance` value and SST measurement in hours | h (hours)| byte |
| [source_of_ssi](__l2p_source_of_ssi) | Source(s) of `surface_solar_irradiance` data | code | byte |
| [or_latitude](__l3_or_latitude) |Original latitude of the satellite measurement as provided in the L2P| degree_north | short or float|
| [or_longitude](__l3_or_longitude) |Original longitude of the satellite measurement as provided in the L2P |degree_east | short or float|
| [or_number_of_pixels](__l3_or_number_of_pixels) |Number of original pixels from the L2P contributing to the binned (space and/or time) average| 1 (unitless) | short|
| [sum_sst](__l3_sum_sst) |Sum of the pixel values going into the space and/or time bin | K (kelvin) | float|
| [sum_square_sst](__l3_sum_square_sst) | Sum of the pixel value squares going into the space and/or time bin | K2 (kelvin^2) | float|
| [adjusted_sea_surface_temperature](__l3_adjusted_sea_surface_temperature) |SST adjusted to the reference. Mandatory for adjusted type file | K (kelvin) | short|
| [adjusted_standard_deviation_error](__l3_adjusted_standard_deviation_error) |Total error standard deviation estimate derived from SSES and adjustment method. Mandatory for adjusted type file | K (kelvin) |byte|
| [bias_to_reference_sst](__l3_bias_to_reference_sst) |Bias error derived from comparison with the reference. Mandatory for adjusted type file | K (kelvin) | short|
| [standard_deviation_to_reference_sst](__l3_standard_deviation_to_reference_sst) |Error standard deviation resulting from the bias estimation method. Mandatory for adjusted type file | K (kelvin) | byte|
| [source_of_sst](__l3_source_of_sst) |Source of SST data. Mandatory for super-collated type file |code | byte|
| [other fields](__l2p_optional_fields) | Optional/experimental fields defined by data provider | | |
```

(__l3_or_latitude)=
### `or_latitude`

This variable is the original latitude of the contributing pixel in case of 
remapping to the nearest pixel, or the average latitude of the contributing 
pixels in case of averaging.

The variable `or_latitude` will be included either as a floating point 
variable similarly to the grid latitude and longitude, or as a short variable, 
with the format requirements shown in {numref}`cdl_or_latitude`, if the required
precision is compatible.


```{table} CDL example description of or_latitude variable
:name: cdl_or_latitude

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|short|`or_latitude`|Original latitude of the satellite measurement|degree|
|**CDL Description**|
|**short or_latitude(time, lat, lon);<br> or_latitude:long_name = "original latitude of the SST value";<br> or_latitude:standard_name = “latitude”;<br> or_latitude:units = "degrees_north";<br> or_latitude:_FillValue = -32768s;<br> or_latitude:valid_range = -9000s, 9000s ;<br><br> or_latitude:add_offset = 0.0f ;<br> or_latitude:scale_factor = 0.01f ;<br> or_latitude:comment = “Original latitude of the SST value” ;**|
```

(__l3_or_longitude)=
### `or_longitude`

This variable is the original longitude of the contributing pixel in case of 
remapping to the nearest pixel, or the average longitude of the contributing 
pixels in case of averaging.

The variable `or_longitude` shall be included either as a floating point 
variable similarly to the grid latitude and longitude, or as a short variable, 
with the format requirements shown in {numref}`cdl_or_longitude`, if the 
required precision is compatible.


```{table} CDL example description of or_longitude variable
:name: cdl_or_longitude

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|short|`or_longitude`|Original longitude of the satellite measurement|degree|
|**CDL Description**|
|**short or_longitude(time, lat, lon);<br> or_longitude:long_name = "original longitude of the SST value";<br> or_longitude:standard_name = “longitude”;<br> or_longitude:units = "degrees_east";<br> or_longitude:_FillValue = -32768s;<br> or_longitude:valid_range = -18000s, 18000s ;<br><br> or_longitude:add_offset = 0.0f ;<br> or_longitude:scale_factor = 0.01f ;<br> or_longitude:comment = “Original longitude of the SST value” ;**
|**Comments**|
|<br>|
```

(__l3_or_number_of_pixels)=
### `or_number_of_pixels`

This variable is the number of original pixels from the L2P contributing to 
the binned (space and/or time) average.

The variable `or_number_of_pixels` shall be included with the format 
requirements shown in {numref}`cdl_or_number_of_pixels`.

```{table} CDL example description of or_number_of_pixels variable
:name: cdl_or_number_of_pixels

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|short|`or_number_of_pixels`|Number of pixels from the L2P contributing to the SST value|1 (unitless)|
|**CDL Description**|
|**short or_number_of_pixels(time, lat, lon) ;<br> or_number_of_pixels:long_name = "number of pixels from the L2Ps contributing to the SST value" ;<br> or_number_of_pixels:units = "1" ;<br> or_number_of_pixels:_FillValue = -32768s;<br> or_number_of_pixels:valid_range = 0, 32767s ;<br> or_number_of_pixels:comment = “Original number of pixels from the L2Ps contributing to the SST value” ;**
|**Comments**|
|This variable records the number of original L2P pixels contributing to the SST in case of averaging during the L3 fabrication.|
```

(__l3_sum_sst)=
### `sum_sst`

This variable is the sum of the original SST pixel values contributing to the 
binned (space and/or time) average.

The variable `sum_sst` shall be included with the format requirements shown in
{numref}`cdl_sum_sst`.

```{table} CDL example description of sum_sst variable
:name: cdl_sum_sst
| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|float|	`sum_sst`|Sum of the pixel values going into the space and/or time bin	| K (kelvin) |
|**CDL description**|
|**float sum_sst(time, lat, lon) ;<br> sum_sst:long_name = "sum of contributing pixel sst values" ;<br> sum_sst:_FillValue = -99999f ;<br> sum_sst:units = "kelvin" ;<br> sum_sst:valid_range = -200.0f, 200.0f;<br>  sum_sst:comment = "Sum of orginal contributing pixel sst values" ;**  <br>
|**Comments**|
|This variable records the sum of the original SST values in case of averaging during the L3 fabrication.|
```

(__l3_sum_square_sst)=
### `sum_square_sst`

This variable is the sum of the squares of the original SST pixel values 
contributing to the binned (space and/or time) average.

The variable `sum_square_sst` shall be included with the format requirements 
shown in {numref}`cdl_sum_square_sst`.


```{table} CDL example description of sum_square_sst variable
:name: cdl_sum_square_sst

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|float|	`sum_square_sst`	| Sum of the pixel value squares going into the space and/or time bin 	|kelvin**2|
|**CDL description**|
|**float sum_square_sst(time, lat, lon) ;<br> sum_ square_sst:long_name = "sum of contributing pixel sst value squares" ;<br> sum_ square_sst:standard_name = sum_of_contributing_pixel_sst_value_squares_D;<br> sum_ square_sst:_FillValue = -1f ;<br> sum_ square_sst:units = "kelvin2" ;<br> sum_ square_sst:valid_range = 0.0f, 50000.0f;<br> sum_ square_sst:comment = "Sum of contributing pixel sst value squares" ;**|	
|**Comments**|
|This variable records the sum of squares of the original SST values in case of averaging during the L3 fabrication|
```

(__l3_adjusted_sea_surface_temperature)=
### `adjusted_sea_surface_temperature`

**Mandatory for adjusted type files.**

This variable is the SST adjusted to the reference. See the principles of 
the adjustment procedure in {numref}`adjustment_best_practice`.

The variable `adjusted_sea_surface_temperature` shall be included with the 
format requirements shown in {numref}`cdl_adjusted_sea_surface_temperature`. 


```{table} CDL example description of adjusted_sea_surface_temperature variable
:name: cdl_adjusted_sea_surface_temperature

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|short|	`adjusted_sea_surface_temperature`|	SST values after adjustment to the reference|	K (kelvin)
|**CDL description**|
|**short adjusted_sea_surface_temperature(time, lat, lon) ;<br> adjusted_sea_surface_temperature:long_name = "adjusted sea surface temperature" ;<br> adjusted_sea_surface_temperature:standard_name = sea_surface_skin_temperature, sea_surface_subskin_temperature or sea_surface_foundation_temperature " ;<br> adjusted_sea_surface_temperature:units = "kelvin" ;<br> adjusted_sea_surface_temperature:_FillValue = -32768s ;<br> adjusted_sea_surface_temperature:add_offset = 273.15f ;<br> adjusted_sea_surface_temperature:scale_factor = 0.01f ;<br> adjusted_sea_surface_temperature:valid_range = -300s, 4500s ;<br> adjusted_sea_surface_temperature:reference="ATS_NR_2P" ;<br> adjusted_sea_surface_temperature:comment="Priorities: example: ATS_NR_2P, AVHRRMTA, NAR17_SST, NAR18_SST, AVHRR17_L, AVHRR_18_L, AVHRR17_L, AVHRR18_G, SEVIRI_1H_SST, GOES_12_1H_SST, AMSRE, TMI, MODIS_A, MODIS_T"**|
|**Comments**|
|This variable records the sum of squares of the original SST values in case of averaging during the L3 fabrication|
```

(__l3_adjusted_standard_deviation_error)=
###  `adjusted_standard_deviation_error`

**Mandatory for adjusted type files.**

This variable represents the total error associated with the 
`adjusted_sea_surface_temperature` variable. It represents the accumulated 
error of the SST production (the `sses_standard_deviation`) and the SST 
adjustment (`standard_deviation_to_reference_sst`).

The variable `adjusted_standard_deviation_error` shall be included with the 
format requirements shown in {numref}`cdl_adjusted_standard_deviation_error`. 

```{table} CDL example description of adjusted_standard_deviation_error variable
:name: cdl_adjusted_standard_deviation_error

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|byte|	`adjusted_standard_deviation_error`	|Total error standard deviation estimate derived from SSES and adjustment method|	kelvin|
|**CDL description**|
|**byte adjusted_standard_deviation_error(time, lat, lon) ;<br> adjusted_standard_deviation_error:long_name = "standard deviation error based on L2P SSES and adjustment method" ;<br> adjusted_standard_deviation_error:units = "kelvin" ;<br> adjusted_standard_deviation_error:_FillValue = -128b ;<br> adjusted_standard_deviation_error:add_offset = 1.0f ;<br> adjusted_standard_deviation_error:scale_factor = 0.01f ;<br> adjusted_standard_deviation_error:valid_range = -127b, 127b ;<br>  adjusted_standard_deviation_error:comment = "Cumulated errors of SSES and adjustment method" ;**|
|**Comments**|
|This represents the cumulated errors of SSES and adjustment method |
```

(__l3_bias_to_reference_sst)=
### `bias_to_reference_sst`

**Mandatory for adjusted type files.**

This quantity represents the local value of the adjustment to the reference.

The variable `bias_to_reference_sst` shall be included with the format 
requirements shown in {numref}`cdl_bias_to_reference_sst`. 


```{table} CDL example description of bias_to_reference_sst variable
:name: cdl_bias_to_reference_sst

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|short|	`bias_to_reference_sst`	|Bias error derived from comparison with the reference|	kelvin|
|**CDL description**`|
|**short bias_to_reference_sst (time, lat, lon) ;<br> bias_to_reference_sst:long_name = "bias error derived from reference" ;<br> bias_to_reference_sst:units = "kelvin" ;<br> bias_to_reference_sst:_FillValue = -32768s ;<br> bias_to_reference_sst:add_offset = 0.0f ;<br> bias_to_reference_sst:scale_factor = 0.01f ;<br> bias_to_reference_sst:valid_range = -32767s, 32767s ;<br> bias_to_reference_sst:valid_max = 32767s;<br> bias_to_reference_sst:comment = "Bias estimate derived from comparison between the original SST (native SSES being applied) and the reference sensor SST (original SST - reference SST)" ;**|
|**Comments**|
|This represents the bias estimate derived from comparison between the original SST (native SSES being applied) and the reference sensor SST (original SST - reference SST)|
```

(__l3_standard_deviation_to_reference_sst)=
### `standard_deviation_to_reference_sst`

**Mandatory for adjusted type files.**

This quantity represents the local error standard deviation resulting from the 
bias estimation method.

The variable `standard_deviation_to_reference_sst` shall be included with the 
format requirements shown in {numref}`cdl_standard_deviation_to_reference_sst`.  

```{table} CDL example description of standard_deviation_to_reference_sst variable
:name: cdl_standard_deviation_to_reference_sst

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|byte	|`standard_deviation_to_reference_sst`|	Error standard deviation resulting from the bias estimation method|	kelvin|
|**CDL description**|
|byte standard_deviation_to_reference_sst(time, lat, lon) ;<br> standard_deviation_to_reference_sst:long_name = "standard deviation of the reference error" ;<br> standard_deviation_to_reference_sst:units = "kelvin" ;<br> standard_deviation_to_reference_sst:_FillValue = -128b ;<br> standard_deviation_to_reference_sst:add_offset = 1.0f ;<br> standard_deviation_to_reference_sst:scale_factor = 0.01f ;<br> standard_deviation_to_reference_sst:valid_range = -127b, 127b ;<br> standard_deviation_to_reference_sst:comment = "This represents the error standard deviation estimate resulting from the bias estimation method" ;
|**Comments**|
|This represents the error standard deviation estimate resulting from the bias estimation method|
```

(__l3_source_of_sst)=
### `source_of_sst` 

**Mandatory for super-collated type files.**

This variable represents the source(s) of SST data when merging the 
values from different input datasets.

When only one source is used, this variable is not needed and the appropriate 
text string indicating the source is placed in the `source` attribute of the 
`sea_surface_temperature` variable.

For multiple sources, the GDS-{{gds_version}} requires the following:

- The variable in question should contain an attribute called `flag_meanings`
  and another one called `flag_values`. The `flag_values` attribute shall
  contain a comma-separated list of the numeric codes for the sources of data
  used whose order matches the comma-separated text strings in the 
  `flag_meanings` attribute.
- These text strings and numeric codes do not need to be unique across different
  data sets or even ancillary variables, but must be consistent within a given
  variable and clearly specified within each netCDF variable and its attributes.
  A best practice for naming the text strings in provided in  
  {numref}`product_codes`.

In a super-collated file (L3S), the variable `source_of_sst` shall be included 
with the format requirements shown in {numref}`cdl_source_of_sst`.  


```{table} CDL example description of source_of_sst variable
:name: cdl_source_of_sst

| Storage type | Name             | Description            | Unit   |
|--------------|------------------|------------------------|--------|
|byte|	`source_of_sst`|	Origin of the SST at pixel level|	Code table|
|**CDL description**|
|**byte source_of_sst(time, lat, lon) ;<br> source_of_sst:long_name = "SST product origin" ;<br> source_of_sst:_FillValue = -128b ;<br> source_of_sst:flag_meanings = "AVHRR_SST_METOP_B-OSISAF-L2P-v1.0 VIIRS_NPP-OSPO-L2P-v2.61 VIIRS_N20-OSPO-L2P-v2.61 SLSTRA_MAR_L2P_v1.0 SLSTRB_MAR_L2P_v1.0 SEVIRI_SST-OSISAF-L3C-v1.0 GOES16-OSISAF-L3C-v1.0 ABI_G17-STAR-L3C-v2.71 SEVIRI_IO_SST-OSISAF-L3C-v1.0 AHI_H08-STAR-L3C-v2.7 AMSR2-REMSS-L2P-v8a" ;<br> source_of_sst:flag_values = 70b, 20b, 21b, 80b, 81b, 41b, 52b, 53b, 42b, 85b, 60b ;** 
|**Comments**|
|<br>|
```


## Sample GHRSST L3 file (CDL header)

A complete CDL description of a L3S dataset derived from infrared VIIRS sensors 
on S-NPP, and NOAA-20 platforms (https://doi.org/10.5067/GHLPM-3SS28) is given 
below. It includes some non-standard variables and attributes. 

**ADD INFO HERE**

## Best Practices

(l2_remapping_best_practice)=
### Remapping Level 2 Data to a Fixed Grid 

The remapping procedure consists in remapping the original L2P in swath
projection onto a fixed grid. This remapping should preserve the traceability of
the SST at pixel level and keep the best quality data.

If the original and final grid resolutions are similar, the nearest pixel
remapping should be adopted. To do so, either a “source to target” or a “target
to source” approach may be used. The latter, target to source, which consists in
scanning the target grid points to find the nearest pixel in the source, is
recommended since it avoids creating holes in the remapped field.

If the original grid resolution is finer than the output grid, 
{numref}`regridding1` an averaging procedure can be adopted. For these cases the
best practice is to average the values of all pixels which overlap the product 
cell entirely and which have a L2P confidence record `quality_level` value equal
to the highest encountered within the cell, to produce a single value.

```{figure} images/regridding1.png
---
name: regridding1
---
To illustrate the approach when the L3 product output grid is over-sampled by 
the L2P input data. All pixels labeled p in the input data are possible 
contributors to the value for new cell A.
```

The following practices are recommended by the GDS:

1. In the case of a smaller L2P input pixel than the grid cell size, L3 data 
   product cell values are derived from an average of the L2P pixel which 
   completely overlap the product cell and which have a L2P quality record 
   `quality_level` value equal to the highest encountered within the cell, 
   to produce a single value. 
2. For input pixels that straddle the boundary between output grid cells, a  
   weighting function may be applied to the input values according to the 
   degree of coverage of the output grid cell and according to the SSES. 
3. Only the best quality original data within a grid cell should be averaged 
   to produce the resulting SST value, to preserve the homogeneity of the 
   SST quality (recommendation 1 above). In the case of averaging, the 
   number of contributors can be recorded as well as the sum of the SST 
   values and the sum of the square values of the SST. The SSES and 
   ancillary data (if needed, for instance if there may be more that one 
   SSES couple of values (bias and standard deviation) by quality level) 
   must be averaged accordingly: the `sses_bias` values are averaged 
   similarly as the SST values, the new `sses_standard_deviation` value is 
   the square root of the averaged squared values of the contributing 
   `sses_standard_deviations`. The averaging should account for the nature 
   of the original `l2P_flags`. 
4. In the case of a larger pixel than the L3 grid cell size, 2 approaches 
   can be adopted:
   - The value of the L2P pixel is allocated to the grid cell the closest to 
     the pixel centre.
   - The output grid cell takes the value of the L2P pixel in which its 
     centre lies. In this case the original latitudes and longitudes of the 
     pixel must be recorded, to be able to detect where the original L2P 
     pixel value has been duplicated.  

If the original grid resolution is larger than the output grid (e.g., 
microwave instruments), as illustrated in {numref}`regridding2`, the following 
practices are recommended by the GDS:

```{figure} images/regridding2.png
---
name: regridding2
---
To illustrate the approach when the L3 output grid is under-sampled by the 
L2P data. Either Grid cell C is assigned the value of pixel p, Or grid cell 
A is assigned the value of pixel p and grid cell B is assigned the weighted 
average of p and q provided they both have quality flags with the same rating.
```

(collating_best_practice)=
### Collating Data from the Same Sensor and Platform 

The collating procedure consists of gathering over a unique grid several orbits
or slots (in the case of a geostationary satellite) of the same sensor on the
same platform. This process is often known as “binning” the data. The collating
procedure merges data with different times of observation.

1) For situations in which the collation is to be done for data collected within
   the same day, two cases are met in practice: collation of consecutive orbits
   in the case of data collected from polar orbiting sensors, or the merging of
   consecutive slots in the case of geostationary satellites. In both cases
   there may be multiple candidates for a grid cell.
   a. To collate observations from overlapping orbits of the polar orbiting
   sensors, the selection procedure should prioritize data first by using the
   highest available quality data. If multiple observations share the same
   highest quality, one of two approaches should be taken: either the
   observation with the minimum satellite zenith angle should be selected, or
   the observations should be averaged. If the minimum satellite zenith angle
   approach is taken, the corresponding `sses_bias` and 
   `sses_standard_deviation` should be selected as well. If the averaging
   approach is followed, the `sses_bias` and `sses_standard_deviation` should be
   averaged similarly (note that the new `sses_standard_deviation` value is the
   square root of the averaged squared values of the contributing
   sses_standard_deviation values). Also in the case of averaging, it is good
   practice to record the number of observations being averaged, the sum of the
   SST values, and the sum of the squared SST values. These values can be stored
   in the `or_number_pixels`, `sum_sst`, and `sum_square_sst` variables
   listed in Sections and 8 and 9.
   b. In the case of geostationary data, the selection procedure must prioritize
   data showing the best quality level, and if equal, data closest to the
   representative time (central time) of the L3 time window. In the case of
   geostationary satellites, remapping is not a preliminary step to the
   collating procedure.
2) If averaging over multiple days, only the best quality original data within a
   grid cell should be averaged to produce the resulting SST value, to preserve
   the homogeneity of the SST quality. The number of contributors can be
   recorded (`or_number_pixels`) as well as the sum of the SST values (
   `sum_sst`) and the sum of the square values of the SST (`sum_square_sst`).
   The SSES values should be averaged accordingly: the `sses_bias` values are
   averaged in the same manner as the SST values and the new 
   `sses_standard_deviation` value is the square root of the averaged squared
   values of the contributing `sses_standard_deviation` values. The averaging
   should preserve the nature of the original `l2P_flags`.

(adjustment_best_practice)=
### SST Adjustments 

Most of individual sensors show regional biases resulting in limitations of the
applied algorithms. The objective of the adjustment procedure is to provide a
correction to these regional biases by comparison with a “reference sensor”,
supposedly free from such biases. A variety of sources can be adopted as
references in the adjustment procedure, ranging from AATSR or in situ
measurement to using a median of sensors approach. The adopted reference must be
recorded in the `adjusted_sea_surface_temperature` variable “reference”
attribute.

The adjustment procedure includes the following steps:
1.	application of the SSES,
2.	determination of the bias adjustment to the reference,
3.	evaluation of the error of the adjustment procedure 

```{note}
A skin to subskin conversion may be needed. In that case, please refer to
the STVAL recommendations. The type of the SST variables must be recorded in the
standard_names of the `sea_surface_temperature` and 
`adjusted_sea_surface_temperature` variables. The bias adjustment value at
pixel and the error of the adjustment procedure must be recorded in the
corresponding variables (mandatory).
```

(supercollating_best_practice)=
### Super-Collating Data from Multiple Sensors and Platforms

The building of a super-collated file takes place by merging adjusted collated
L3 files from various sensors over the same grid and over the same time window.
There is one input candidate file (and hence one candidate observation) per
sensor. There may be multiple candidates for a given grid cell originating from
different sensors. To make the selection from among the candidates, a “decision
tree” or selection hierarchy should be established a priori. This hierarchy
depends on the objective of the super-collation procedure, and may be quite
different for a moderate resolution (10km) super-collated over 24h aiming to
feed a foundation SST analysis and for a high resolution (2km) hourly subskin
SST super-collated aiming to feed a diurnal warming analysis, for example.
Because the hierarchy must be established based on the intended use of the
super-collated dataset that results, it is out of the scope of this document to
define any single hierarchy. However, the adopted hierarchy must be described in
the `comment` attribute of the `adjusted_sea_surface_temperature` variable.
In addition, it is mandatory to provide the source of the SST (`source_of_sst`)
at the grid cell level.
